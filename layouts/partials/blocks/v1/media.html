{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $title := $block.Params.title }}
{{ $subtitle := $block.Params.subtitle }}

  <div class="row">
      <div class="section-heading col-12 col-lg-4 mb-3 mb-lg-0 d-flex flex-column align-items-center align-items-lg-start">
     {{ with $title }}
      <h1 class="mb-0">{{ . | markdownify }}</h1>
    {{ end }} 
     {{ with $subtitle }}
      <p class="mt-1">{{ . | markdownify }}</p>
    {{ end }} 
    </div>
      
    <div class="article-container">
                <div class="row">


    {{ with $block.Content }}
      <div class="mt-1">{{ . }}</div>
    {{ end }}
    
{{ $url := "assets/csv/media.csv" }}
{{ $content := readFile $url }}
    {{ $options := dict "delimiter" "," }}
    {{ $rows := $content | transform.Unmarshal $options }}
    {{ range $i, $r :=  $rows }} <!-- (dict "mediaarticles" (slice "author" "date" "outlet" "title" "language" "link")) -->
        {{ if ne $i 0 }} <!-- Skip the first row -->
            <p class="mt-1">
                <!-- Date (col 1) -->
<!-- Date (col 1) -->
{{ $dateStr := trim (index $r 1) " " }}
{{ if $dateStr }}

  {{ $parts := split $dateStr "-" }}
  {{ if eq (len $parts) 3 }}

    {{ $day := printf "%02s" (index $parts 0) }}
    {{ $monthStr := index $parts 1 }}
    {{ $yearShort := index $parts 2 }}

    {{/* Convert month name to number */}}
    {{ $months := dict 
        "Jan" "01" "Feb" "02" "Mar" "03" "Apr" "04"
        "May" "05" "Jun" "06" "Jul" "07" "Aug" "08"
        "Sep" "09" "Oct" "10" "Nov" "11" "Dec" "12" }}

    {{ $month := index $months $monthStr }}

    {{/* Convert 2-digit year to 4-digit (assumes 2000s) */}}
    {{ $year := printf "20%s" $yearShort }}

    {{ $iso := printf "%s-%s-%s" $year $month $day }}

    {{ $t := time $iso }}
    {{ $t | time.Format "02 January 2006" }} on

  {{ else }}
    {{ $dateStr }}
  {{ end }}

{{ end }}



                
                <!-- Outlet (col 2), Author  (col 0) -->
                {{ index $r 2 }}{{ if index $r 0 }} by {{ index $r 0 }}{{ end }}.
                
                <!-- Link (col 5) + Title (col 3) -->
                {{ if index $r 5 }}<a href="{{ index $r 5 }}" target="_blank">{{ end }} <!-- Link -->
                {{ index $r 3 }} <!-- Title -->
                {{ if index $r 5 }}</a>{{ end }} <!-- Close link -->
                
                <!-- Language (col 4) -->
                (in {{ index $r 4 }}).
                
                <!-- Icon (col 6) -->
                {{ if index $r 6 }}
                  {{ if eq (index $r 6) "text" }}<i class="fa-brands fa-readme" style="color: {{ site.Data.themes.chb.light.primary | safeCSS}};"></i>{{ end }}
                  {{ if eq (index $r 6) "audio" }}<i class="fa-solid fa-ear-listen" style="color: {{ site.Data.themes.chb.light.primary | safeCSS}};"></i>{{ end }}
                  {{ if eq (index $r 6) "video" }}<i class="fa-solid fa-video" style="color: {{ site.Data.themes.chb.light.primary | safeCSS }};"></i>{{ end }}
                {{ end }}
            </p>
        {{ end }}
    {{ end }}

    </div>
  </div>
</div>